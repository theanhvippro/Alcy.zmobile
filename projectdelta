local ScriptName = "ALCY.Z HUB" -- Tên Hub hiện trên bảng
local WorkerUrl = "https://alcyhubkeysystem.nguyentheanh05022011.workers.dev" 
local DiscordLink = "https://discord.gg/sqseejxeV"

-- // [LURAPH MACROS]
if not LPH_OBFUSCATED then
    getgenv().LPH_JIT_ULTRA = function(f) return f() end
    getgenv().LPH_NO_VIRTUALIZE = function(f) return f end
    getgenv().LPH_ENCSTR = function(...) return ... end
    getgenv().LPH_ENCNUM = function(...) return ... end
    getgenv().LPH_CRASH = function() while true do end end
end

local script_success, script_error = pcall(function()
    LPH_JIT_ULTRA(function()
        -- // [SERVICES]
        local TweenService = game:GetService("TweenService")
        local HttpService = game:GetService("HttpService")
        local Players = game:GetService("Players")
        local RunService = game:GetService("RunService")
        local CoreGui = game:GetService("CoreGui")
        local LocalPlayer = Players.LocalPlayer

        -- Hàm lấy GUI an toàn
        local function GetSafeGuiRoot()
            local success, core = pcall(function() return game:GetService("CoreGui") end)
            if success and core then return core end
            return LocalPlayer:WaitForChild("PlayerGui")
        end
        local GUI_ROOT = GetSafeGuiRoot()

        -- // [UTILS & NETWORK]
        local function Z(x) return x end;
        local lDigest = Z
        local function jsonDecode(json) return HttpService:JSONDecode(json) end
        local fSetClipboard = setclipboard or toclipboard
        local fRequest = request or http_request or syn_request
        local fGetHwid = gethwid or function() return game:GetService("Players").LocalPlayer.UserId end
        local cachedLink, cachedTime = "", 0

        -- Hàm Cache Link Key
        local cacheLinkFunc = LPH_NO_VIRTUALIZE(function()
            if not fRequest then return false, "No Request Support" end
            if cachedTime + (10 * 60) < os.time() then
                local cleanUrl = WorkerUrl:gsub("/+$", "")
                local response = fRequest({
                    Url = cleanUrl .. "/get-link?identifier=" .. lDigest(fGetHwid()),
                    Method = "GET"
                })
                if response.StatusCode == 200 then
                    local decoded = jsonDecode(response.Body)
                    if decoded.success then
                        cachedLink = decoded.data.url
                        cachedTime = os.time()
                        return true, cachedLink
                    end
                end
                return false, "API Error"
            end
            return true, cachedLink
        end)

        -- Hàm Verify Key (Đã thêm Admin Key)
        local verifyKeyFunc = LPH_NO_VIRTUALIZE(function(key)
            -- [ADMIN KEY CHECK]
            if key == "Admin₫_AOPX_JKCV_3839" then return true end

            if not fRequest then return false end
            local cleanUrl = WorkerUrl:gsub("/+$", "")
            local endpoint = cleanUrl .. "/verify?identifier=" .. lDigest(fGetHwid()) .. "&key=" .. key
            local response = fRequest({Url = endpoint, Method = "GET"})
            if response.StatusCode == 200 then
                local decoded = jsonDecode(response.Body)
                if decoded.valid then return true end
            end
            return false
        end)

        -- // [UI CONSTRUCTION]
        if GUI_ROOT:FindFirstChild("AlcyKeysystemV8") then
            GUI_ROOT:FindFirstChild("AlcyKeysystemV8"):Destroy()
        end

        local ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "AlcyKeysystemV8"
        ScreenGui.Parent = GUI_ROOT
        ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        ScreenGui.ResetOnSpawn = false

        local LightingBlur = Instance.new("BlurEffect")
        LightingBlur.Name = "AlcyBlur"
        LightingBlur.Size = 0
        LightingBlur.Parent = game:GetService("Lighting")

        -- Main Card (Draggable)
        local MainCard = Instance.new("Frame")
        MainCard.Name = "MainCard"
        MainCard.Parent = ScreenGui
        MainCard.Size = UDim2.new(0, 460, 0, 270)
        MainCard.Position = UDim2.new(0.5, 0, 0.5, 0)
        MainCard.AnchorPoint = Vector2.new(0.5, 0.5)
        MainCard.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        MainCard.BackgroundTransparency = 0.5
        MainCard.Active = true 
        MainCard.Draggable = true 
        Instance.new("UICorner", MainCard).CornerRadius = UDim.new(0, 16)

        -- Sparkle Border
        local RGBStroke = Instance.new("UIStroke")
        RGBStroke.Parent = MainCard
        RGBStroke.Thickness = 3
        RGBStroke.Transparency = 0
        RGBStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

        local BorderGradient = Instance.new("UIGradient")
        BorderGradient.Color = ColorSequence.new{
            ColorSequenceKeypoint.new(0.00, Color3.fromRGB(255, 0, 255)),
            ColorSequenceKeypoint.new(0.20, Color3.fromRGB(0, 255, 255)),
            ColorSequenceKeypoint.new(0.40, Color3.fromRGB(255, 255, 255)), -- Sparkle point
            ColorSequenceKeypoint.new(0.60, Color3.fromRGB(255, 255, 0)),
            ColorSequenceKeypoint.new(0.80, Color3.fromRGB(0, 255, 100)),
            ColorSequenceKeypoint.new(1.00, Color3.fromRGB(255, 0, 255))
        }
        BorderGradient.Parent = RGBStroke

        -- Inner Content
        local InnerContent = Instance.new("Frame")
        InnerContent.Parent = MainCard
        InnerContent.Size = UDim2.new(1, -6, 1, -6)
        InnerContent.Position = UDim2.new(0.5, 0, 0.5, 0)
        InnerContent.AnchorPoint = Vector2.new(0.5, 0.5)
        InnerContent.BackgroundColor3 = Color3.fromRGB(10, 8, 15)
        InnerContent.ClipsDescendants = true
        Instance.new("UICorner", InnerContent).CornerRadius = UDim.new(0, 13)

        local Pattern = Instance.new("ImageLabel")
        Pattern.Parent = InnerContent
        Pattern.Size = UDim2.new(1, 0, 1, 0)
        Pattern.Image = "rbxassetid://6071575925"
        Pattern.ImageColor3 = Color3.fromRGB(120, 50, 255)
        Pattern.ImageTransparency = 0.94
        Pattern.ScaleType = Enum.ScaleType.Tile
        Pattern.TileSize = UDim2.new(0, 30, 0, 30)
        Pattern.BackgroundTransparency = 1

        -- UI Elements
        local Header = Instance.new("TextLabel")
        Header.Parent = InnerContent
        Header.Text = ScriptName .. " <font color=\"#ff00ff\">KEY</font>"
        Header.RichText = true
        Header.Font = Enum.Font.GothamBlack
        Header.TextSize = 28
        Header.TextColor3 = Color3.fromRGB(255, 255, 255)
        Header.BackgroundTransparency = 1
        Header.Position = UDim2.new(0, 25, 0, 20)
        Header.TextXAlignment = Enum.TextXAlignment.Left

        local SubHeader = Instance.new("TextLabel")
        SubHeader.Parent = InnerContent
        SubHeader.Text = "// PROJECT DELTA"
        SubHeader.Font = Enum.Font.Code
        SubHeader.TextSize = 12
        SubHeader.TextColor3 = Color3.fromRGB(140, 140, 180)
        SubHeader.BackgroundTransparency = 1
        SubHeader.Position = UDim2.new(0, 25, 0, 48)
        SubHeader.TextXAlignment = Enum.TextXAlignment.Left

        local InputBg = Instance.new("Frame")
        InputBg.Parent = InnerContent
        InputBg.Size = UDim2.new(1, -50, 0, 45)
        InputBg.Position = UDim2.new(0.5, 0, 0.42, 0)
        InputBg.AnchorPoint = Vector2.new(0.5, 0)
        InputBg.BackgroundColor3 = Color3.fromRGB(25, 22, 35)
        Instance.new("UICorner", InputBg).CornerRadius = UDim.new(0, 8)
        
        local KeyInput = Instance.new("TextBox")
        KeyInput.Parent = InputBg
        KeyInput.Size = UDim2.new(1, -20, 1, 0)
        KeyInput.Position = UDim2.new(0, 15, 0, 0)
        KeyInput.BackgroundTransparency = 1
        KeyInput.Font = Enum.Font.GothamBold
        KeyInput.Text = ""
        KeyInput.PlaceholderText = "Paste Key Here..."
        KeyInput.TextColor3 = Color3.fromRGB(255, 255, 255)
        KeyInput.PlaceholderColor3 = Color3.fromRGB(90, 80, 110)
        KeyInput.TextSize = 14

        local StatusText = Instance.new("TextLabel")
        StatusText.Parent = InnerContent
        StatusText.Size = UDim2.new(1, 0, 0, 20)
        StatusText.Position = UDim2.new(0, 0, 0.62, 0)
        StatusText.BackgroundTransparency = 1
        StatusText.Text = "Status: Waiting..."
        StatusText.TextColor3 = Color3.fromRGB(150, 150, 150)
        StatusText.Font = Enum.Font.GothamMedium
        StatusText.TextSize = 12

        local ButtonContainer = Instance.new("Frame")
        ButtonContainer.Parent = InnerContent
        ButtonContainer.Size = UDim2.new(1, -50, 0, 40)
        ButtonContainer.Position = UDim2.new(0.5, 0, 0.76, 0)
        ButtonContainer.AnchorPoint = Vector2.new(0.5, 0)
        ButtonContainer.BackgroundTransparency = 1

        local function CreateButton(text, order, color1, color2)
            local BtnFrame = Instance.new("Frame")
            BtnFrame.Parent = ButtonContainer
            local width = 0.31
            local gap = 0.035
            BtnFrame.Size = UDim2.new(width, 0, 1, 0)
            BtnFrame.Position = UDim2.new((order-1)*(width+gap), 0, 0, 0)
            BtnFrame.BackgroundColor3 = color1
            Instance.new("UICorner", BtnFrame).CornerRadius = UDim.new(0, 6)

            local Grad = Instance.new("UIGradient")
            Grad.Color = ColorSequence.new{ColorSequenceKeypoint.new(0, color1), ColorSequenceKeypoint.new(1, color2)}
            Grad.Rotation = 45
            Grad.Parent = BtnFrame

            local Btn = Instance.new("TextButton")
            Btn.Parent = BtnFrame
            Btn.Size = UDim2.new(1, 0, 1, 0)
            Btn.BackgroundTransparency = 1
            Btn.Text = text
            Btn.TextColor3 = Color3.new(1,1,1)
            Btn.Font = Enum.Font.GothamBold
            Btn.TextSize = 11

            Btn.MouseEnter:Connect(function() TweenService:Create(BtnFrame, TweenInfo.new(0.2), {Size = UDim2.new(width, 0, 1.1, 0)}):Play();
            TweenService:Create(Grad, TweenInfo.new(0.5), {Rotation = 135}):Play() end)
            Btn.MouseLeave:Connect(function() TweenService:Create(BtnFrame, TweenInfo.new(0.2), {Size = UDim2.new(width, 0, 1, 0)}):Play(); TweenService:Create(Grad, TweenInfo.new(0.5), {Rotation = 45}):Play() end)
            return Btn
        end

        local VerifyBtn = CreateButton("VERIFY", 1, Color3.fromRGB(150, 0, 255), Color3.fromRGB(200, 50, 255))
        local DiscordBtn = CreateButton("DISCORD", 2, Color3.fromRGB(88, 101, 242), Color3.fromRGB(120, 130, 250))
        local GetKeyBtn = CreateButton("GET KEY", 3, Color3.fromRGB(255, 140, 0), Color3.fromRGB(255, 180, 50))

        -- // [VISUAL ANIMATION]
        task.spawn(function()
            TweenService:Create(LightingBlur, TweenInfo.new(0.5), {Size = 20}):Play()
            MainCard.Size = UDim2.new(0, 0, 0, 0)
            TweenService:Create(MainCard, TweenInfo.new(0.6, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 460, 0, 270)}):Play()
            local rot, sparkleTime = 0, 0
            while MainCard.Parent do
                local dt = RunService.Heartbeat:Wait()
                rot = rot + (dt * 60);
                if rot > 360 then rot = 0 end; BorderGradient.Rotation = rot
                sparkleTime = sparkleTime + (dt * 5)
                RGBStroke.Thickness = 3.5 + math.sin(sparkleTime) * 1.5 
                RGBStroke.Transparency = 0.1 + math.sin(sparkleTime * 2) * 0.1
            end
        end)

        -- // [MAIN SCRIPT LOADER]
        local function LoadMainScript()
            StatusText.Text = "Checked Key."
            StatusText.TextColor3 = Color3.fromRGB(0, 255, 100)
            TweenService:Create(MainCard, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.new(0,0,0,0)}):Play()
            TweenService:Create(LightingBlur, TweenInfo.new(0.5), {Size = 0}):Play()
            task.wait(0.5)
            ScreenGui:Destroy()
            LightingBlur:Destroy()

            print("Running Main Script...") 
            
            -- ====================================================
            -- PROJECT DELTA MOBILE SCRIPT | Optimized Physics (Gravity 9.2 + Drag 0.013)
            -- ====================================================
            
            if not LPH_OBFUSCATED then
                LPH_JIT = function(...) return ... end
                LPH_JIT_MAX = function(...) return ... end
                LPH_NO_VIRTUALIZE = function(f) return f end
                LPH_NO_UPVALUES = function(f) return function(...) return f(...) end end
                LPH_ENCSTR = function(...) return ... end
                LPH_ENCNUM = function(...) return ... end
                LPH_CRASH = function() return print(debug.traceback()) end
            end

            local success, err = pcall(function()
                -- // Services
                local repo = LPH_ENCSTR("https://raw.githubusercontent.com/deividcomsono/Obsidian/main/")
                local Library = loadstring(game:HttpGet(repo .. "Library.lua"))()
                local ThemeManager = loadstring(game:HttpGet(repo .. "addons/ThemeManager.lua"))()
                local SaveManager = loadstring(game:HttpGet(repo .. "addons/SaveManager.lua"))()

                local Players = game:GetService("Players")
                local RunService = game:GetService("RunService")
                local Workspace = game:GetService("Workspace")
                local Lighting = game:GetService("Lighting")
                local ReplicatedStorage = game:GetService("ReplicatedStorage")
                local Debris = game:GetService("Debris")
                local UserInputService = game:GetService("UserInputService")
                local TweenService = game:GetService("TweenService")
                local VirtualInputManager = game:GetService("VirtualInputManager")

                -- // Local Variables
                local LocalPlayer = Players.LocalPlayer
                local Camera = Workspace.CurrentCamera
                
                -- [GLOBAL TARGET FOR HOOK ACCESS]
                local CurrentTarget = nil

                local AiZones = workspace:FindFirstChild("AiZones")
                local DroppedItemsFolder = workspace:WaitForChild("DroppedItems", 5)
                local ContainersFolder = workspace:WaitForChild("Containers", 5)

                -- // Remotes Setup
                local Remotes = ReplicatedStorage:WaitForChild("Remotes")
                local RagdollRemote = Remotes:FindFirstChild("Ragdoll")
                local DamageIndicatorRemote = Remotes:FindFirstChild("DamageIndicator")
                local NoDamageIndEnabled = false
                
                -- [REMOVED OLD HOOK HERE TO PLACE IT LATER]

                local bulletSuccess, Bullet = pcall(require, ReplicatedStorage:WaitForChild("Modules"):WaitForChild("FPS"):WaitForChild("Bullet"))
                if not bulletSuccess then Library:Notify("Module Error: Silent Aim may fail.", 8) end

                -- // Global Settings
                getgenv().SilentAimEnabled = false
                getgenv().FOV_RADIUS = 100

                -- Gun Mods Variables
                local NoRecoilEnabled, NoSpreadEnabled = false, false
                -- [NOTE] Đã xóa NoBulletDropEnabled để đảm bảo an toàn Anticheat
                local RapidFireEnabled, RapidFireCount = false, 1 

                local HitboxEnabled, HitboxSize, HitboxTransparency = false, 3, 0.7
                local BulletTrackerEnabled, SilentWalkEnabled, SilentWalkSpeed, AntiRagdollEnabled = false, false, 20, false
                local TriggerbotEnabled, TriggerbotDelay, TriggerbotIsShooting = false, 0.05, false

                local TrackerSettings = { Color = Color3.fromRGB(255, 0, 0), Material = "ForceField", Width = 0.3, Transparency = 0.3 }
                local AmmoFolder = ReplicatedStorage:WaitForChild("AmmoTypes")
                local OriginalAmmoData = {}

                -- [[ GLOBAL WHITELIST FOR ESP & INVENTORY ]]
                local WeaponWhitelist = {
                    ["Mosin"] = true, ["AKMN"] = true, ["MK23"] = true, ["M4"] = true, ["M4A1"] = true,
                    ["FAL"] = true, ["AsVal"] = true, ["AKM"] = true, ["ADAR15"] = true, ["ZSh"] = true,
                    ["VZ61"] = true, ["PKM"] = true, ["MP5SD"] = true, ["MP443"] = true, ["IZh12"] = true,
                    ["IZh81"] = true, ["R700"] = true, ["SKS"] = true, ["Makarov"] = true, ["SVD"] = true,
                    ["Saiga12"] = true, ["TT-33"] = true, ["DV2"] = true
                }

                local Settings = {
                    ESPEnabled = true, ESPDistance = 500, BoxType = "Box",
                    ESPBox = true, ESPBoxColor = Color3.fromRGB(0, 180, 255),
                    ESPBoxFillEnabled = false, ESPBoxFillColor = Color3.fromRGB(0, 180, 255), ESPBoxFillTransparency = 0.7,
                    ESPName = true, ESPNameColor = Color3.fromRGB(255, 255, 255), ESPSkeleton = true, ESPBoneColor = Color3.fromRGB(170, 255, 0),
                    ESPDistanceText = true, ESPDistanceColor = Color3.fromRGB(255, 255, 255), ESPHealthBar = true,
                    
                    -- [[ WEAPON ESP SETTINGS ]]
                    ESPWeapon = true, ESPWeaponColor = Color3.fromRGB(255, 255, 0),

                    ItemESP = false, ItemDist = 500, ItemTextSize = 13, ItemColor = Color3.fromRGB(0, 255, 100),
                    CrateESP = false, CrateName = true, CrateHighlight = true, CrateDist = 1000,
                    CrateTextSize = 13, CrateTextColor = Color3.fromRGB(255, 170, 0), CrateHighlightColor = Color3.fromRGB(255, 0, 0),
                    AttESP = false, AttColor = Color3.fromRGB(255, 0, 255), AttSize = 13,
                    AmmoESP = false, AmmoColor = Color3.fromRGB(255, 255, 0), AmmoSize = 12,
                    PlayerChams = false, PlayerChamsFill = true, PlayerChamsOutline = true, PlayerFillColor = Color3.fromRGB(255, 0, 0), PlayerOutlineColor = Color3.fromRGB(255, 255, 255),
                
                    -- [[ AI SETTINGS UPDATED ]]
                    AiHighlight = false, AiChamsFill = true, AiChamsOutline = true, AiFillColor = Color3.fromRGB(255, 170, 0), AiOutlineColor = Color3.fromRGB(255, 255, 255),
                    AiName = true, AiTextSize = 13, AiNameColor = Color3.fromRGB(255, 255, 255),

                    SilentAimEnabled = false, SilentPart = "Head", Prediction = true, AimbotIgnoreAI = false, IgnoredPlayers = {},
                    ShowFOV = true, FOVRadius = 100, FOVColor = Color3.fromRGB(0, 255, 255), FOVPosition = "Mouse",
                    ShowTargetLine = false, TargetLineColor = Color3.fromRGB(255, 0, 0),
                    TargetMode = "Visible", ShowVisStatus = true, VisTextSize = 18, VisColor = Color3.fromRGB(0, 255, 0),
                    InventoryViewer = false, FOVLock = false, CameraFOV = 90, SilentSteps = false, AmbientLock = true, BaseAmbientColor = Color3.fromRGB(127, 127, 127), AmbientBrightness = 1,
                    
                    -- [INSTANT HIT VARIABLE]
                    InstantHit = false
                }

                -- // GUI Setup
                local Window = Library:CreateWindow({ Title = LPH_ENCSTR("Alcy.z Hub"), Footer = "Mobile script", Icon = 0, NotifySide = "Right", ShowCustomCursor = true })
                local Tabs = {
                    Aim = Window:AddTab("Silent Aim", "crosshair"), Gun = Window:AddTab("Gun Mods", "shield"),
                    Vis = Window:AddTab("Visuals", "eye"), Item = Window:AddTab("Items", "box"),
                    Misc = Window:AddTab("Misc", "settings"), Map = Window:AddTab("Map", "map"), UI = Window:AddTab("UI Settings", "menu"),
                }

                -- [AIM TAB]
                local AimGroup = Tabs.Aim:AddLeftGroupbox("Silent Aim Logic")
                local FOVGroup = Tabs.Aim:AddRightGroupbox("FOV Settings")
                local TriggerGroup = Tabs.Aim:AddRightGroupbox("Triggerbot")
            
                AimGroup:AddToggle("SilentAimEnabled", { Text = "Enable Silent Aim", Default = false, Callback = function(v) Settings.SilentAimEnabled = v; getgenv().SilentAimEnabled = v end })
                AimGroup:AddToggle("InstantHit", { Text = "Instant Hit (Blatant)", Default = false, Callback = function(v) Settings.InstantHit = v end }) -- [ADDED UI]
                
                AimGroup:AddDropdown("SilentPart", { Values = {"Head", "HumanoidRootPart"}, Default = 1, Multi = false, Text = "Target Part", Callback = function(v) Settings.SilentPart = v end })
                AimGroup:AddDropdown("TargetMode", { Values = {"Visible", "Crosshair", "Distance"}, Default = 1, Multi = false, Text = "Target Priority", Callback = function(v) Settings.TargetMode = v end })
                AimGroup:AddToggle("ShowVisStatus", { Text = "Show Visible/Hidden", Default = true, Callback = function(v) Settings.ShowVisStatus = v end })
                AimGroup:AddSlider("VisTextSize", { Text = "Status Text Size", Default = 18, Min = 10, Max = 40, Rounding = 0, Callback = function(v) Settings.VisTextSize = v end })
                AimGroup:AddLabel("Status Color"):AddColorPicker("VisColor", { Default = Color3.fromRGB(0, 255, 0), Callback = function(v) Settings.VisColor = v end })
            
                AimGroup:AddToggle("Prediction", { Text = "Safe Prediction (G:9.2 | D:0.013)", Default = true, Callback = function(v) Settings.Prediction = v end })
                AimGroup:AddToggle("AimbotIgnoreAI", { Text = "Ignore AI", Default = false, Callback = function(v) Settings.AimbotIgnoreAI = v end })
                AimGroup:AddDivider()
                local IgnorePlayerDropdown = AimGroup:AddDropdown("IgnorePlayerList", { Values = {}, Default = {}, Multi = true, Text = "Ignore Players", Callback = function(v) Settings.IgnoredPlayers = v end })
                local function UpdatePlayerDropdown()
                    local pList = {}
                    for _, v in pairs(Players:GetPlayers()) do if v ~= LocalPlayer then table.insert(pList, v.Name) end end
                    if IgnorePlayerDropdown.SetValues then IgnorePlayerDropdown:SetValues(pList) else if IgnorePlayerDropdown.Refresh then IgnorePlayerDropdown:Refresh(pList, true) end end
                end
                AimGroup:AddButton("Refresh Player List", function() UpdatePlayerDropdown(); Library:Notify("Player list updated!", 3) end); task.delay(1, UpdatePlayerDropdown)
                TriggerGroup:AddToggle("Triggerbot", { Text = "Enable Triggerbot", Default = false, Callback = function(v) TriggerbotEnabled = v end })
                TriggerGroup:AddSlider("TriggerDelay", { Text = "Reaction Delay", Default = 0.05, Min = 0, Max = 0.5, Rounding = 2, Suffix = "s", Callback = function(v) TriggerbotDelay = v end })
                local FOVToggle = FOVGroup:AddToggle("ShowFOV", { Text = "Show FOV Circle", Default = true, Callback = function(v) Settings.ShowFOV = v end })
                FOVToggle:AddColorPicker("FOVColor", { Default = Color3.fromRGB(0, 255, 255), Callback = function(v) Settings.FOVColor = v end })
                FOVGroup:AddSlider("FOVRadius", { Text = "FOV Radius", Default = 100, Min = 10, Max = 400, Rounding = 0, Suffix = "px", Callback = function(v) Settings.FOVRadius = v; getgenv().FOV_RADIUS = v end })
                FOVGroup:AddDropdown("FOVPosition", { Values = {"Mouse", "Center"}, Default = 1, Text = "FOV Position", Callback = function(v) Settings.FOVPosition = v end })
                local TargetLineToggle = FOVGroup:AddToggle("ShowTargetLine", { Text = "Show Target Line", Default = false, Callback = function(v) Settings.ShowTargetLine = v end })
                TargetLineToggle:AddColorPicker("TargetLineColor", { Default = Color3.fromRGB(255, 0, 0), Callback = function(v) Settings.TargetLineColor = v end })

                -- [GUN TAB]
                local WeaponGroup = Tabs.Gun:AddLeftGroupbox("Weapon Handling")
                local BulletGroup = Tabs.Gun:AddRightGroupbox("Bullet Visuals")
                
                local function CacheAmmoData(ammo)
                    if not OriginalAmmoData[ammo] then
                        OriginalAmmoData[ammo] = { RecoilStrength = ammo:GetAttribute("RecoilStrength"), Spread = ammo:GetAttribute("Spread"), HipSpread = ammo:GetAttribute("HipSpread"), ProjectileDrop = ammo:GetAttribute("ProjectileDrop"), Acceleration = ammo:GetAttribute("Acceleration"), Gravity = ammo:GetAttribute("Gravity"), Drag = ammo:GetAttribute("Drag"), MuzzleVelocity = ammo:GetAttribute("MuzzleVelocity") }
                    end
                end
                for _, ammo in pairs(AmmoFolder:GetChildren()) do CacheAmmoData(ammo) end
                
                -- [SAFETY UPDATE] Hàm chỉ mod Recoil/Spread, KHÔNG mod Drop/Drag
                local function ForceWeaponMods()
                    for _, ammo in pairs(AmmoFolder:GetChildren()) do
                        local data = OriginalAmmoData[ammo]
                        if data then
                            if NoRecoilEnabled and ammo:GetAttribute("RecoilStrength") ~= 0 then ammo:SetAttribute("RecoilStrength", 0) end
                            if NoSpreadEnabled then if ammo:GetAttribute("Spread") ~= 0 then ammo:SetAttribute("Spread", 0) end; if ammo:GetAttribute("HipSpread") ~= 0 then ammo:SetAttribute("HipSpread", 0) end end
                        end
                    end
                end
                AmmoFolder.ChildAdded:Connect(function(ammo) task.wait(); CacheAmmoData(ammo); ForceWeaponMods() end)
            
                WeaponGroup:AddToggle("NoRecoil", { Text = "No Recoil", Default = false, Callback = function(v) NoRecoilEnabled = v; if v then ForceWeaponMods() end end })
                WeaponGroup:AddToggle("NoSpread", { Text = "No Spread", Default = false, Callback = function(v) NoSpreadEnabled = v; if v then ForceWeaponMods() end end })
                
                WeaponGroup:AddDivider()
                WeaponGroup:AddToggle("RapidFire", { Text = "Rapid Fire (Multishot)", Default = false, Tooltip = "Fires multiple bullets at once", Callback = function(v) RapidFireEnabled = v end })
                WeaponGroup:AddSlider("RapidFireCount", { Text = "Bullet Count", Default = 1, Min = 1, Max = 20, Rounding = 0, Callback = function(v) RapidFireCount = v end })
                WeaponGroup:AddDivider()

                local function ResetHitbox()
                    for _, plr in ipairs(Players:GetPlayers()) do 
                        if plr ~= LocalPlayer and plr.Character then 
                            local targetPart = plr.Character:FindFirstChild("FaceHitBox") or plr.Character:FindFirstChild("Head")
                            if targetPart then 
                                if targetPart.Name == "Head" then targetPart.Size = Vector3.new(1.1, 1, 1) elseif targetPart:FindFirstChild("OriginalSize") then targetPart.Size = targetPart.OriginalSize.Value else targetPart.Size = Vector3.new(1, 1, 1) end
                                targetPart.Transparency = 0; targetPart.CanCollide = true 
                            end 
                        end 
                    end
                end
                WeaponGroup:AddToggle("HitboxExpander", { Text = "Big Head (All)", Default = false, Callback = function(v) HitboxEnabled = v; if not v then ResetHitbox() end end })
                WeaponGroup:AddSlider("HitboxSize", { Text = "Hitbox Size", Default = 3, Min = 2, Max = 10, Rounding = 1, Callback = function(v) HitboxSize = v end })
                local BulletToggle = BulletGroup:AddToggle("BulletTracker", { Text = "Bullet Tracer (Beam)", Default = false, Callback = function(v) BulletTrackerEnabled = v end })
                BulletToggle:AddColorPicker("TrackerColor", { Default = Color3.fromRGB(255, 0, 0), Callback = function(v) TrackerSettings.Color = v end })
                BulletGroup:AddDropdown("TrackerMat", { Values = {"Neon", "ForceField", "Plastic"}, Default = 2, Text = "Tracker Material", Callback = function(v) TrackerSettings.Material = v end })

                -- [VISUAL TAB]
                local ESPGroup = Tabs.Vis:AddLeftGroupbox("Player ESP"); local ChamGroup = Tabs.Vis:AddRightGroupbox("Highlights"); local InvGroup = Tabs.Vis:AddRightGroupbox("Inventory")
                ESPGroup:AddToggle("ESPEnabled", { Text = "Enable Master ESP", Default = true, Callback = function(v) Settings.ESPEnabled = v end })
                ESPGroup:AddSlider("ESPDistance", { Text = "Render Distance", Default = 500, Min = 10, Max = 1000, Suffix = "m", Callback = function(v) Settings.ESPDistance = v end })
                ESPGroup:AddDropdown("BoxType", { Values = {"Box", "Corner"}, Default = 1, Multi = false, Text = "Box Type", Callback = function(v) Settings.BoxType = v end })
                
                local BoxToggle = ESPGroup:AddToggle("ESPBox", { Text = "Show Box", Default = true, Callback = function(v) Settings.ESPBox = v end }); BoxToggle:AddColorPicker("ESPBoxColor", { Default = Color3.fromRGB(0, 180, 255), Callback = function(v) Settings.ESPBoxColor = v end })
                local NameToggle = ESPGroup:AddToggle("ESPName", { Text = "Show Name", Default = true, Callback = function(v) Settings.ESPName = v end }); NameToggle:AddColorPicker("ESPNameColor", { Default = Color3.fromRGB(255, 255, 255), Callback = function(v) Settings.ESPNameColor = v end })
                local DistToggle = ESPGroup:AddToggle("ESPDistanceText", { Text = "Show Distance", Default = true, Callback = function(v) Settings.ESPDistanceText = v end }); DistToggle:AddColorPicker("ESPDistanceColor", { Default = Color3.fromRGB(255, 255, 255), Callback = function(v) Settings.ESPDistanceColor = v end })
                local SkelToggle = ESPGroup:AddToggle("ESPSkeleton", { Text = "Show Skeleton", Default = true, Callback = function(v) Settings.ESPSkeleton = v end }); SkelToggle:AddColorPicker("ESPBoneColor", { Default = Color3.fromRGB(170, 255, 0), Callback = function(v) Settings.ESPBoneColor = v end })
                
                -- [[ WEAPON ESP TOGGLE ]]
                local WeapToggle = ESPGroup:AddToggle("ESPWeapon", { Text = "Show Weapon", Default = true, Callback = function(v) Settings.ESPWeapon = v end })
                WeapToggle:AddColorPicker("ESPWeaponColor", { Default = Color3.fromRGB(255, 255, 0), Callback = function(v) Settings.ESPWeaponColor = v end })

                ESPGroup:AddToggle("ESPHealthBar", { Text = "Show Health Bar", Default = true, Callback = function(v) Settings.ESPHealthBar = v end })
                local PlayerChamToggle = ChamGroup:AddToggle("PlayerChams", { Text = "Player Highlights", Default = false, Callback = function(v) Settings.PlayerChams = v end }); PlayerChamToggle:AddColorPicker("PlayerFillColor", { Default = Color3.fromRGB(255, 0, 0), Callback = function(v) Settings.PlayerFillColor = v end }); PlayerChamToggle:AddColorPicker("PlayerOutlineColor", { Default = Color3.fromRGB(255, 255, 255), Callback = function(v) Settings.PlayerOutlineColor = v end })
                
                local AiChamToggle = ChamGroup:AddToggle("AiHighlight", { Text = "AI Highlights", Default = false, Callback = function(v) Settings.AiHighlight = v end }); AiChamToggle:AddColorPicker("AiFillColor", { Default = Color3.fromRGB(255, 170, 0), Callback = function(v) Settings.AiFillColor = v end }); AiChamToggle:AddColorPicker("AiOutlineColor", { Default = Color3.fromRGB(255, 255, 255), Callback = function(v) Settings.AiOutlineColor = v end })
                
                local AiNameToggle = ChamGroup:AddToggle("AiName", { Text = "Show AI Name", Default = true, Callback = function(v) Settings.AiName = v end })
                AiNameToggle:AddColorPicker("AiNameColor", { Default = Color3.fromRGB(255, 255, 255), Callback = function(v) Settings.AiNameColor = v end })
                ChamGroup:AddSlider("AiTextSize", { Text = "AI Name Size", Default = 13, Min = 8, Max = 24, Callback = function(v) Settings.AiTextSize = v end })

                local InvGui, InvFrame, InvNameLabel, InvSlot1Label, InvSlot2Label, InvHeadLabel, InvBodyLabel, InvBagLabel
                local function CreateInventoryGUI() 
                    if InvGui then InvGui:Destroy() end; if LocalPlayer.PlayerGui:FindFirstChild("RealtimeInventory") then LocalPlayer.PlayerGui.RealtimeInventory:Destroy() end
                    InvGui = Instance.new("ScreenGui"); InvGui.Name = "RealtimeInventory"; InvGui.ResetOnSpawn = false; InvGui.Parent = LocalPlayer:WaitForChild("PlayerGui"); InvGui.Enabled = false
                    InvFrame = Instance.new("Frame"); InvFrame.Size = UDim2.new(0, 250, 0, 180); InvFrame.Position = UDim2.new(1, -260, 0, 10); InvFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 30); InvFrame.BackgroundTransparency = 0.15; InvFrame.Parent = InvGui
                    local UICorner = Instance.new("UICorner"); UICorner.CornerRadius = UDim.new(0, 12);
                    UICorner.Parent = InvFrame; local UIStroke = Instance.new("UIStroke"); UIStroke.Color = Color3.fromRGB(80, 80, 90); UIStroke.Thickness = 2; UIStroke.Parent = InvFrame
                    local UIListLayout = Instance.new("UIListLayout"); UIListLayout.Padding = UDim.new(0, 6);
                    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder; UIListLayout.Parent = InvFrame
                    local function createLabel(text, color, bold) local lbl = Instance.new("TextLabel"); lbl.Size = UDim2.new(1, -10, 0, 22); lbl.BackgroundTransparency = 1; lbl.TextColor3 = color; lbl.TextXAlignment = Enum.TextXAlignment.Left; lbl.Font = bold and Enum.Font.GothamBold or Enum.Font.Gotham; lbl.TextSize = 14; lbl.Text = " " .. text; lbl.Parent = InvFrame; return lbl end
                    InvNameLabel = createLabel("Target: None", Color3.fromRGB(255, 230, 50), true); InvSlot1Label = createLabel("1. None", Color3.fromRGB(0, 255, 0), false); InvSlot2Label = createLabel("2. None", Color3.fromRGB(0, 200, 255), false); InvHeadLabel = createLabel("Head: None", Color3.fromRGB(200, 200, 200), false); InvBodyLabel = createLabel("Body: None", Color3.fromRGB(200, 200, 200), false); InvBagLabel = createLabel("Backpack: None", Color3.fromRGB(200, 200, 200), false) 
                end
                CreateInventoryGUI(); LocalPlayer.CharacterAdded:Connect(function() task.wait(1); CreateInventoryGUI() end)
                local function getGearType(name) local n = string.lower(name); if string.find(n, "helmet") or string.find(n, "mũ") or string.find(n, "vis") or string.find(n, "altyn") then return "Head" end; if string.find(n, "vest") or string.find(n, "armor") or string.find(n, "giáp") or string.find(n, "rig") then return "Body" end; if string.find(n, "bag") or string.find(n, "pack") or string.find(n, "balo") then return "Backpack" end; return nil end
                local function UpdateTargetInventory(targetName) 
                    if not InvGui or not InvNameLabel then return end
                    local playersFolder = ReplicatedStorage:FindFirstChild("Players"); if not playersFolder then return end; local playerFolder = playersFolder:FindFirstChild(targetName)
                    if not playerFolder then InvNameLabel.Text = " Target: " .. targetName .. " (AI/No Data)"; InvGui.Enabled = true; return end
                    local inventory = playerFolder:FindFirstChild("Inventory"); if inventory then local weapons = {}; local gear = {Head="None", Body="None", Backpack="None"}; for _, item in pairs(inventory:GetChildren()) do if WeaponWhitelist[item.Name] then local score = 0; if item:FindFirstChild("Attachments") then score = #item.Attachments:GetChildren() * 10 end; local iName = string.lower(item.Name); if string.find(iName, "ak") or string.find(iName, "m4") or string.find(iName, "ar") then score = score + 5 end; table.insert(weapons, {Name=item.Name, Score=score}) else local gType = getGearType(item.Name); if gType then gear[gType] = item.Name end end end
                    table.sort(weapons, function(a,b) return a.Score > b.Score end); InvNameLabel.Text = " Target: " .. targetName; InvSlot1Label.Text = weapons[1] and " 1. "..weapons[1].Name or " 1. None"; InvSlot2Label.Text = weapons[2] and " 2. "..weapons[2].Name or " 2. None"; InvHeadLabel.Text = " Head: "..gear.Head; InvBodyLabel.Text = " Body: "..gear.Body; InvBagLabel.Text = " Backpack: "..gear.Backpack; InvGui.Enabled = true end 
                end
                InvGroup:AddToggle("InventoryViewer", { Text = "Inventory Viewer", Default = false, Callback = function(v) Settings.InventoryViewer = v; if not v and InvGui then InvGui.Enabled = false end end })

                -- [ITEM TAB]
                local DropGroup = Tabs.Item:AddLeftGroupbox("Dropped Items"); local CrateGroup = Tabs.Item:AddRightGroupbox("Crates"); local AttGroup = Tabs.Item:AddRightGroupbox("Modded Gun & Ammo ESP")
                local ItemEspToggle = DropGroup:AddToggle("ItemESP", { Text = "Esp lootbox", Default = false, Callback = function(v) Settings.ItemESP = v end }); ItemEspToggle:AddColorPicker("ItemColor", { Default = Color3.fromRGB(0, 255, 100), Callback = function(v) Settings.ItemColor = v end })
                DropGroup:AddSlider("ItemDist", { Text = "Distance", Default = 200, Min = 100, Max = 700, Suffix = "m", Callback = function(v) Settings.ItemDist = v end }); DropGroup:AddSlider("ItemTextSize", { Text = "Text Size", Default = 13, Min = 8, Max = 24, Callback = function(v) Settings.ItemTextSize = v end })
                CrateGroup:AddToggle("CrateESP", { Text = "Enable Crate ESP", Default = false, Callback = function(v) Settings.CrateESP = v end }); local CrateNameToggle = CrateGroup:AddToggle("CrateName", { Text = "Show Name", Default = true, Callback = function(v) Settings.CrateName = v end }); CrateNameToggle:AddColorPicker("CrateTextColor", { Default = Color3.fromRGB(255, 170, 0), Callback = function(v) Settings.CrateTextColor = v end })
                local CrateHlToggle = CrateGroup:AddToggle("CrateHighlight", { Text = "Show Highlight", Default = true, Callback = function(v) Settings.CrateHighlight = v end }); CrateHlToggle:AddColorPicker("CrateHighlightColor", { Default = Color3.fromRGB(255, 0, 0), Callback = function(v) Settings.CrateHighlightColor = v end })
                CrateGroup:AddSlider("CrateDist", { Text = "Distance", Default = 200, Min = 100, Max = 700, Suffix = "m", Callback = function(v) Settings.CrateDist = v end })
                AttGroup:AddToggle("AttESP", { Text = "Show Modded Guns", Default = false, Callback = function(v) Settings.AttESP = v end }); AttGroup:AddLabel("Gun Text Color"):AddColorPicker("AttColor", { Default = Color3.fromRGB(255, 0, 255), Callback = function(v) Settings.AttColor = v end }); AttGroup:AddSlider("AttSize", { Text = "Gun Text Size", Default = 13, Min = 8, Max = 24, Callback = function(v) Settings.AttSize = v end })
                AttGroup:AddDivider(); AttGroup:AddToggle("AmmoESP", { Text = "Show Ammo/Mags", Default = false, Callback = function(v) Settings.AmmoESP = v end }); AttGroup:AddLabel("Ammo Text Color"):AddColorPicker("AmmoColor", { Default = Color3.fromRGB(255, 255, 0), Callback = function(v) Settings.AmmoColor = v end }); AttGroup:AddSlider("AmmoSize", { Text = "Ammo Text Size", Default = 12, Min = 8, Max = 24, Callback = function(v) Settings.AmmoSize = v end })

                -- [MISC TAB]
                local CharGroup = Tabs.Misc:AddLeftGroupbox("Character"); local CamGroup = Tabs.Misc:AddRightGroupbox("Camera")
                CharGroup:AddToggle("SilentWalk", { Text = "Silent Walk (Speed)", Default = false, Callback = function(v) SilentWalkEnabled = v end }); CharGroup:AddSlider("WalkSpeed", { Text = "Speed", Default = 20, Min = 5, Max = 50, Callback = function(v) SilentWalkSpeed = v end })
                
                -- ===================== [UPDATE: HIGH JUMP] =====================
                local CFrameJumpEnabled = false
                local CFrameJumpHeight = 20

                CharGroup:AddDivider()
                CharGroup:AddToggle("Jump", { 
                    Text = "High Jump", 
                    Default = false, 
                    Callback = function(v) 
                        CFrameJumpEnabled = v 
                    end 
                })
                
                CharGroup:AddSlider("JumpHeight", { 
                    Text = "Jump Height", 
                    Default = 20, 
                    Min = 10, 
                    Max = 50, 
                    Rounding = 0, 
                    Callback = function(v) 
                        CFrameJumpHeight = v 
                    end 
                })

                UserInputService.JumpRequest:Connect(function()
                    if CFrameJumpEnabled and LocalPlayer.Character then
                        local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                        if hrp then
                            -- Dịch chuyển thẳng lên trên theo trục Y
                            hrp.CFrame = hrp.CFrame + Vector3.new(0, CFrameJumpHeight, 0)
                        end
                    end
                end)
                -- ===============================================================

                CharGroup:AddToggle("SilentSteps", { Text = "Silent Footsteps", Default = false, Callback = function(v) Settings.SilentSteps = v end }); CharGroup:AddToggle("AntiRagdoll", { Text = "Anti-Ragdoll", Default = false, Callback = function(v) AntiRagdollEnabled = v end })
                CharGroup:AddToggle("NoDamageInd", { Text = "No Damage Indicator", Default = false, Callback = function(v) NoDamageIndEnabled = v end })
                CamGroup:AddToggle("FOVLock", { Text = "Custom FOV (Ultra Smooth)", Default = false, Callback = function(v) Settings.FOVLock = v end }); CamGroup:AddSlider("CameraFOV", { Text = "Field of View", Default = 90, Min = 30, Max = 120, Callback = function(v) Settings.CameraFOV = v end })

                -- [MAP TAB]
                local MapOpt = Tabs.Map:AddLeftGroupbox("Optimization"); local MapEnv = Tabs.Map:AddRightGroupbox("Environment")
                local function safeDisable(name) local obj = Lighting:FindFirstChild(name); if obj and (obj:IsA("PostEffect") or obj:IsA("Atmosphere")) then obj.Enabled = false end end
                MapOpt:AddButton("Remove All Effects", function() local effects = {"WaterBlur", "SunRays", "LowHealthEffect", "InventoryBlur", "HurtEffect", "DepthOfFieldInteraction", "DDOF", "ADS_DOF"}; for _, name in pairs(effects) do safeDisable(name) end; local atm = Lighting:FindFirstChild("Atmosphere"); if atm then atm:Destroy() end; for _, v in pairs(Lighting:GetChildren()) do if v:IsA("Sky") then v:Destroy() end end; Library:Notify("Removed all map effects!") end)
                MapOpt:AddButton("Remove Trees", function() local sz = Workspace:FindFirstChild("SpawnerZones"); if sz and sz:FindFirstChild("Foliage") then sz.Foliage:ClearAllChildren() end end)
                MapOpt:AddButton("Fullbright", function() Settings.BaseAmbientColor = Color3.fromRGB(255, 255, 255); Settings.AmbientBrightness = 1; Settings.AmbientLock = true; Lighting.Brightness = 2; Lighting.GlobalShadows = false end)
                MapEnv:AddSlider("AmbientBrightness", { Text = "Ambient Brightness", Default = 127, Min = 0, Max = 255, Callback = function(v) Settings.AmbientBrightness = v/255 end }); MapEnv:AddLabel("Ambient Tint"):AddColorPicker("AmbientTint", { Default = Color3.fromRGB(127,127,127), Callback = function(v) Settings.BaseAmbientColor = v end })
                MapEnv:AddButton("Set Time: Day", function() Lighting.ClockTime = 12 end); MapEnv:AddButton("Set Time: Night", function() Lighting.ClockTime = 0 end)

                ThemeManager:SetLibrary(Library); SaveManager:SetLibrary(Library); SaveManager:IgnoreThemeSettings(); SaveManager:SetFolder("ProjectDelta"); SaveManager:BuildConfigSection(Tabs.UI); ThemeManager:ApplyToTab(Tabs.UI);
                SaveManager:LoadAutoloadConfig()

                -- // Drawing Objects
                local FOV = Drawing.new("Circle"); FOV.Visible = true; FOV.Radius = getgenv().FOV_RADIUS; FOV.Color = Color3.fromRGB(0, 255, 255); FOV.Thickness = 1; FOV.Filled = false
                local Snapline = Drawing.new("Line"); Snapline.Visible = false; Snapline.Thickness = 1.2; Snapline.Color = Color3.fromRGB(255, 0, 0)
                local VisStatusText = Drawing.new("Text"); VisStatusText.Visible = false; VisStatusText.Center = true; VisStatusText.Outline = true; VisStatusText.Font = 2; VisStatusText.Color = Color3.fromRGB(0, 255, 0); VisStatusText.Size = 18

                local DroppedItemDrawings = {}; local CrateDrawings = {};
                local ValidCrateNames = { ["LargeABPOPABox"] = true, ["LargeMilitaryBox"] = true, ["SmallMilitaryBox"] = true }
                local CachedCrates = {}; if ContainersFolder then for _, obj in pairs(ContainersFolder:GetDescendants()) do if ValidCrateNames[obj.Name] then table.insert(CachedCrates, obj) end end; ContainersFolder.DescendantAdded:Connect(function(obj) if ValidCrateNames[obj.Name] then table.insert(CachedCrates, obj) end end) end
                local skeletonConnectionsR15 = {{"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"}, {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"}, {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"}, {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"}}
                local ESPConnections = {}
                local function isSameTeam(playerA, playerB) if not playerA or not playerB then return false end; if playerA.Team and playerB.Team then return playerA.Team == playerB.Team end; return false end
                local function worldToScreen(pos) local screen, onScreen = Camera:WorldToViewportPoint(pos); return Vector2.new(screen.X, screen.Y), onScreen end
                local function destroyESP(plr) 
                    local esp = ESPConnections[plr]; if esp then pcall(function() if esp.conn then esp.conn:Disconnect() end; if esp.box then esp.box:Remove() end; if esp.boxFill then esp.boxFill:Remove() end; if esp.nameText then esp.nameText:Remove() end; if esp.HealthBarBG then esp.HealthBarBG:Remove() end; if esp.HealthBarFill then esp.HealthBarFill:Remove() end; if esp.distanceText then esp.distanceText:Remove() end; if esp.weaponText then esp.weaponText:Remove() end; for _,l in pairs(esp.skeletonLines or {}) do if l then l:Remove() end end; for _,l in pairs(esp.cornerLines or {}) do if l then l:Remove() end end end); ESPConnections[plr] = nil end 
                end
                local function HideAllESP(espData) espData.box.Visible = false; espData.boxFill.Visible = false; espData.nameText.Visible = false; espData.HealthBarBG.Visible = false; espData.HealthBarFill.Visible = false; espData.distanceText.Visible = false; if espData.weaponText then espData.weaponText.Visible = false end; for _,l in pairs(espData.skeletonLines) do l.Visible = false; for _,l in pairs(espData.cornerLines or {}) do l.Visible = false end end end

                -- // [WEAPON SCANNER: STRICT WHITELIST + DV2 ONLY]
                local function GetEquippedWeapon(char)
                    if not char then return "None" end
                    for _, child in pairs(char:GetChildren()) do
                        if child:IsA("Model") or child:IsA("Tool") then
                            if WeaponWhitelist[child.Name] then return child.Name end
                            if string.find(child.Name, "DV2") then return child.Name end
                        end
                    end
                    return "None"
                end

                local function UpdatePlayerESP(player, espData)
                    if not Settings.ESPEnabled then HideAllESP(espData); return end
                    if not player or not player.Parent then destroyESP(player); return end
                    if isSameTeam(LocalPlayer, player) then HideAllESP(espData); return end
                    
                    local char = player.Character; local hrp = char and (char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso")); local humanoid = char and char:FindFirstChild("Humanoid")
                    if not char or not hrp or not humanoid or humanoid.Health <= 0 then HideAllESP(espData); return end
                    
                    local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); local distance = myHRP and (myHRP.Position - hrp.Position).Magnitude or 0; local distanceInMeters = distance * 0.29 
                    if distanceInMeters > Settings.ESPDistance then HideAllESP(espData); return end
                    
                    espData.box.Color = Settings.ESPBoxColor; espData.boxFill.Color = Settings.ESPBoxFillColor; espData.boxFill.Transparency = Settings.ESPBoxFillTransparency; 
                    espData.nameText.Color = Settings.ESPNameColor; espData.distanceText.Color = Settings.ESPDistanceColor; if espData.weaponText then espData.weaponText.Color = Settings.ESPWeaponColor end
                    for _,l in pairs(espData.skeletonLines) do l.Color = Settings.ESPBoneColor end
                    
                    local head = char:FindFirstChild("Head"); local headWorldPos = head.Position + Vector3.new(0, head.Size.Y / 2 + 0.5, 0); local footWorldPos = hrp.Position - Vector3.new(0, 3.5, 0); local headPos, headOnScreen = worldToScreen(headWorldPos); local footPos, footOnScreen = worldToScreen(footWorldPos)
                    
                    if not headOnScreen or not footOnScreen then HideAllESP(espData); return end
                    
                    local boxHeight = math.abs(footPos.Y - headPos.Y); local boxWidth = boxHeight / 1.8; local minX = headPos.X - boxWidth/2; local minY = headPos.Y
                    
                    if Settings.ESPBox then 
                        if Settings.BoxType == "Box" then espData.box.Size = Vector2.new(boxWidth, boxHeight); espData.box.Position = Vector2.new(minX, minY); espData.box.Visible = true; for _, l in pairs(espData.cornerLines) do l.Visible = false end 
                        else espData.box.Visible = false; local len = math.min(boxWidth, boxHeight) / 3; local cLines = espData.cornerLines
                            if cLines and #cLines >= 8 then
                                local tl = Vector2.new(minX, minY); local tr = Vector2.new(minX + boxWidth, minY); local bl = Vector2.new(minX, minY + boxHeight); local br = Vector2.new(minX + boxWidth, minY + boxHeight)
                                cLines[1].From = tl; cLines[1].To = tl + Vector2.new(len, 0); cLines[1].Visible = true; cLines[1].Color = Settings.ESPBoxColor; cLines[2].From = tl; cLines[2].To = tl + Vector2.new(0, len); cLines[2].Visible = true; cLines[2].Color = Settings.ESPBoxColor
                                cLines[3].From = tr; cLines[3].To = tr - Vector2.new(len, 0); cLines[3].Visible = true; cLines[3].Color = Settings.ESPBoxColor; cLines[4].From = tr; cLines[4].To = tr + Vector2.new(0, len); cLines[4].Visible = true; cLines[4].Color = Settings.ESPBoxColor
                                cLines[5].From = bl; cLines[5].To = bl + Vector2.new(len, 0); cLines[5].Visible = true; cLines[5].Color = Settings.ESPBoxColor; cLines[6].From = bl; cLines[6].To = bl - Vector2.new(0, len); cLines[6].Visible = true; cLines[6].Color = Settings.ESPBoxColor
                                cLines[7].From = br; cLines[7].To = br - Vector2.new(len, 0); cLines[7].Visible = true; cLines[7].Color = Settings.ESPBoxColor; cLines[8].From = br; cLines[8].To = br - Vector2.new(0, len); cLines[8].Visible = true; cLines[8].Color = Settings.ESPBoxColor
                            end
                        end
                        if Settings.ESPBoxFillEnabled then espData.boxFill.Size = Vector2.new(boxWidth, boxHeight); espData.boxFill.Position = Vector2.new(minX, minY); espData.boxFill.Visible = true else espData.boxFill.Visible = false end 
                    else espData.box.Visible = false; espData.boxFill.Visible = false; for _, l in pairs(espData.cornerLines) do l.Visible = false end end
                    
                    if Settings.ESPName then espData.nameText.Text = player.Name; espData.nameText.Size = 13; espData.nameText.Position = Vector2.new(headPos.X, minY - 16); espData.nameText.Visible = true else espData.nameText.Visible = false end
                    
                    if Settings.ESPHealthBar then local hpPercent = math.clamp(humanoid.Health / humanoid.MaxHealth, 0, 1); local barWidth = 2; local fillHeight = boxHeight * hpPercent; local barX = minX - barWidth - 4;
                    espData.HealthBarBG.Size = Vector2.new(barWidth, boxHeight); espData.HealthBarBG.Position = Vector2.new(barX, minY); espData.HealthBarBG.Visible = true; espData.HealthBarFill.Size = Vector2.new(barWidth, fillHeight); espData.HealthBarFill.Position = Vector2.new(barX, minY + (boxHeight - fillHeight)); espData.HealthBarFill.Color = Color3.fromHSV(hpPercent * 0.3, 1, 1); espData.HealthBarFill.Visible = true else espData.HealthBarBG.Visible = false; espData.HealthBarFill.Visible = false end
                    
                    if Settings.ESPDistanceText then espData.distanceText.Text = math.floor(distanceInMeters) .. "m"; espData.distanceText.Size = 12; espData.distanceText.Position = Vector2.new(headPos.X, minY + boxHeight + 2); espData.distanceText.Visible = true else espData.distanceText.Visible = false end
                    
                    if Settings.ESPWeapon and espData.weaponText then local weaponName = GetEquippedWeapon(char); espData.weaponText.Text = weaponName; espData.weaponText.Size = 11; local yOffset = Settings.ESPDistanceText and 14 or 2; espData.weaponText.Position = Vector2.new(headPos.X, minY + boxHeight + 2 + yOffset); espData.weaponText.Visible = true else if espData.weaponText then espData.weaponText.Visible = false end end

                    if Settings.ESPSkeleton then for i, line in ipairs(espData.skeletonLines) do local pair = skeletonConnectionsR15[i]; if pair then local partA, partB = char:FindFirstChild(pair[1]), char:FindFirstChild(pair[2]); if partA and partB then local posA, onScreenA = worldToScreen(partA.Position); local posB, onScreenB = worldToScreen(partB.Position); if onScreenA and onScreenB then line.From = posA; line.To = posB; line.Visible = true; line.Thickness = 1 else line.Visible = false end else line.Visible = false end else line.Visible = false end end else for _, l in pairs(espData.skeletonLines) do l.Visible = false end end
                end
                local function createSimpleESP(player) 
                    destroyESP(player); if not player or player == LocalPlayer then return end; 
                    local box = Drawing.new("Square"); box.Thickness = 1; box.Visible = false; box.Filled = false; 
                    local boxFill = Drawing.new("Square"); boxFill.Visible = false; boxFill.Filled = true;
                    local nameText = Drawing.new("Text"); nameText.Center = true; nameText.Outline = true; nameText.Visible = false; 
                    local HealthBarBG = Drawing.new("Square"); HealthBarBG.Filled = true; HealthBarBG.Color = Color3.new(0,0,0); 
                    local HealthBarFill = Drawing.new("Square"); HealthBarFill.Filled = true; 
                    local distanceText = Drawing.new("Text"); distanceText.Center = true; distanceText.Outline = true; distanceText.Visible = false; 
                    local weaponText = Drawing.new("Text"); weaponText.Center = true; weaponText.Outline = true; weaponText.Visible = false;
                    local skeletonLines = {}; for _ = 1, #skeletonConnectionsR15 do local l = Drawing.new("Line"); l.Visible = false; table.insert(skeletonLines, l) end; 
                    local cornerLines = {}; for i=1, 8 do local l = Drawing.new("Line"); l.Thickness = 1; l.Visible = false; table.insert(cornerLines, l) end;
                    local conn = player.AncestryChanged:Connect(function(_, parent) if not parent then destroyESP(player) end end);
                    ESPConnections[player] = { box = box, boxFill = boxFill, nameText = nameText, HealthBarBG = HealthBarBG, HealthBarFill = HealthBarFill, distanceText = distanceText, weaponText = weaponText, skeletonLines = skeletonLines, cornerLines = cornerLines, conn = conn } 
                end
                for _,plr in pairs(Players:GetPlayers()) do createSimpleESP(plr) end; Players.PlayerAdded:Connect(createSimpleESP); Players.PlayerRemoving:Connect(destroyESP)
                local function UpdateHighlight(model, fillColor, outlineColor, enabled, fillEnabled, outlineEnabled) if not model then return end; local hl = model:FindFirstChild("RayfieldHighlight"); if not enabled then if hl then hl:Destroy() end return end; if not hl then hl = Instance.new("Highlight"); hl.Name = "RayfieldHighlight"; hl.Parent = model end; hl.FillColor = fillColor; hl.OutlineColor = outlineColor; hl.FillTransparency = fillEnabled and 0.5 or 1; hl.OutlineTransparency = outlineEnabled and 0 or 1 end
                local function GetCenter() return Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2) end
                local function CreateBulletBeam(origin, targetPos) local part = Instance.new("Part"); part.Anchored = true; part.CanCollide = false; part.Transparency = 1; part.Position = origin; part.Parent = Workspace; local attachment0 = Instance.new("Attachment", part); local attachment1 = Instance.new("Attachment", part); attachment1.WorldPosition = targetPos; local beam = Instance.new("Beam", part); beam.Attachment0 = attachment0; beam.Attachment1 = attachment1; beam.Color = ColorSequence.new(TrackerSettings.Color); beam.FaceCamera = true; beam.Width0 = TrackerSettings.Width or 0.2; beam.Width1 = TrackerSettings.Width or 0.2; if TrackerSettings.Material == "Neon" then beam.LightEmission = 1; beam.LightInfluence = 0; beam.Texture = "rbxassetid://446111271"; beam.Transparency = NumberSequence.new(0.2) elseif TrackerSettings.Material == "ForceField" then beam.LightEmission = 1; beam.LightInfluence = 0; beam.Texture = "rbxassetid://446111271"; beam.TextureSpeed = 2; beam.Transparency = NumberSequence.new(0) else beam.LightEmission = 0; beam.LightInfluence = 1; beam.Texture = ""; beam.Transparency = NumberSequence.new(0) end; Debris:AddItem(part, 2) end

                -- // Logic Aim & Prediction
                local function isVisible(origin, targetPart, ...) local ignore = { Camera, LocalPlayer.Character, ... }; if AiZones then table.insert(ignore, AiZones) end; local direction = targetPart.Position - origin; local raycastParams = RaycastParams.new(); raycastParams.FilterType = Enum.RaycastFilterType.Exclude; raycastParams.FilterDescendantsInstances = ignore; raycastParams.IgnoreWater = true; local result = Workspace:Raycast(origin, direction, raycastParams); if result then if result.Instance:IsDescendantOf(targetPart.Parent) then return true end return false end return true end
                local function getAi() local ai = {}; if AiZones then for _, zone in ipairs(AiZones:GetChildren()) do for _, character in ipairs(zone:GetChildren()) do table.insert(ai, character) end end end; return ai end
                local function GetTarget(ignoreModels)
                    local closestTarget = nil; local closestMetric = math.huge
                    local origin = UserInputService:GetMouseLocation(); if Settings.FOVPosition == "Center" then origin = GetCenter() end
                    local function checkEntity(char)
                        if not char then return end; local hrp = char:FindFirstChild("HumanoidRootPart"); local humanoid = char:FindFirstChild("Humanoid")
                        if not hrp or not humanoid or humanoid.Health <= 0 then return end
                        local myHRP = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if not myHRP then return end
                        local distToTarget = (hrp.Position - myHRP.Position).Magnitude
                        if (distToTarget * 0.29) > Settings.ESPDistance then return end
                        local hitPart = char:FindFirstChild(Settings.SilentPart) or hrp
                        if Settings.TargetMode == "Visible" and not isVisible(Camera.CFrame.Position, hitPart, ignoreModels) then return end
                        local metric = 0
                        if Settings.TargetMode == "Distance" then metric = distToTarget or (hitPart.Position - Camera.CFrame.Position).Magnitude else local screenPosition, onScreen = Camera:WorldToViewportPoint(hitPart.Position); if not onScreen then return end; metric = (Vector2.new(screenPosition.X, screenPosition.Y) - origin).Magnitude; if metric > Settings.FOVRadius then return end end
                        if metric < closestMetric then closestMetric = metric; closestTarget = hitPart end
                    end
                    if not Settings.AimbotIgnoreAI then for _, char in ipairs(getAi()) do checkEntity(char) end end
                    for _, plr in ipairs(Players:GetPlayers()) do if plr ~= LocalPlayer and not isSameTeam(LocalPlayer, plr) then local isIgnored = false; if Settings.IgnoredPlayers and Settings.IgnoredPlayers[plr.Name] then isIgnored = true end; if not isIgnored then checkEntity(plr.Character) end end end
                    return closestTarget
                end
                
                -- // [HOOK IMPLEMENTATION]
                -- Replaces the old hook and integrates Instant Hit Logic
                local mt = getrawmetatable(game)
                setreadonly(mt, false)
                local oldNamecall = mt.__namecall
                mt.__namecall = newcclosure(LPH_NO_VIRTUALIZE(function(self, ...)
                    local args = {...}
                    local method = getnamecallmethod()

                    -- 1. No Damage Indicator Logic
                    if NoDamageIndEnabled and (method == "FireServer" or method == "FireClient") and self == DamageIndicatorRemote then
                        return nil
                    end
                    
                    -- 2. Instant Hit Logic
                    if Settings.SilentAimEnabled and Settings.InstantHit and CurrentTarget then
                        -- Server: Force NaN speed (Hit Instantly)
                        if method == "InvokeServer" and self.Name == "FireProjectile" then
                            args[3] = 0/0 
                            return oldNamecall(self, unpack(args))
                        end
                        
                        -- Client: Redirect Raycast (Fix Visuals/Client Checks)
                        if method == "Raycast" and not checkcaller() then
                             args[2] = (CurrentTarget.Position - args[1]) -- Redirect Vector
                             return oldNamecall(self, unpack(args))
                        end
                    end

                    return oldNamecall(self, ...)
                end))
                setreadonly(mt, true)


                -- // [FINAL PHYSICS] GRAVITY 9.2 & DRAG 0.013
                local GAME_GRAVITY = Vector3.new(0, 9.2, 0) -- Gravity bù trừ (Dương)
                local GAME_DRAG = 0.013 -- Drag chuẩn của game

                -- Giải phương trình bậc 2 (Dự phòng)
                local solveQuadratic = LPH_JIT_MAX(function(A, B, C) 
                    if math.abs(A) < 1e-5 then 
                        if math.abs(B) < 1e-5 then return nil, nil end 
                        local root = -C / B 
                        return root, root 
                    end 
                    local discriminant = B^2 - 4*A*C 
                    if discriminant < 0 then return nil, nil end 
                    local discRoot = math.sqrt(discriminant) 
                    return (-B - discRoot) / (2*A), (-B + discRoot) / (2*A) 
                end)

                -- [PRO LOGIC] Tính thời gian bay có Drag (Logarit)
                local getBallisticFlightTime = LPH_JIT_MAX(function(distanceVec, gravity, projectileSpeed, drag) 
                    local distance = distanceVec.Magnitude
                    
                    -- Fallback: Nếu Drag <= 0, dùng vật lý thường
                    if drag <= 0 then
                        local A = gravity:Dot(gravity) / 4 
                        local B = gravity:Dot(distanceVec) - projectileSpeed^2 
                        local C = distanceVec:Dot(distanceVec) 
                        local root1, root2 = solveQuadratic(A, B, C) 
                        if root1 and root2 then 
                            if root1 > 0 and (root2 < 0 or root1 < root2) then return math.sqrt(root1) 
                            elseif root2 > 0 then return math.sqrt(root2) end 
                        end 
                        return distance / projectileSpeed
                    end

                    -- Công thức: t = -1/k * ln(1 - d*k/v)
                    local k = drag
                    local v = projectileSpeed
                    
                    -- Impossible shot check
                    if (distance * k) / v >= 1 then 
                        return distance / (v * 0.5) -- Fallback
                    end

                    local time = -(1/k) * math.log(1 - (distance * k) / v)
                    return time
                end)

                if hookfunction and Bullet then
                    local oldBullet
                    oldBullet = hookfunction(Bullet.CreateBullet, function(idk, model, model2, model3, aimPart, idk2, ammoType, tick, recoilPattern)
                        local finalArgs = {idk, model, model2, model3, aimPart, idk2, ammoType, tick, recoilPattern}
                        
                        if Settings.SilentAimEnabled then
                            local target = GetTarget({model, model2, model3}) 
                            if target then
                                local bulletData = ReplicatedStorage.AmmoTypes:FindFirstChild(ammoType)
                                -- [NOTE] Không mod MuzzleVelocity để tránh ban
                                local projectileSpeed = bulletData:GetAttribute("MuzzleVelocity")
                                
                                local gravity = GAME_GRAVITY 
                                local drag = GAME_DRAG
                                
                                local diff = target.Position - aimPart.Position
                                
                                -- Tính toán thời gian bay với Drag
                                local time = getBallisticFlightTime(diff, gravity, projectileSpeed, drag)
                                
                                -- Prediction: Dự đoán vị trí địch xa hơn do đạn bay chậm dần
                                local predictedPos = target.Position
                                if Settings.Prediction then
                                    predictedPos = target.Position + (target.Velocity * time)
                                end
                                
                                -- Drop Compensation: Gravity dương 9.2 + Time dài hơn -> Aim cao hơn
                                local dropCompensation = 0.5 * gravity * time^2
                                local finalPos = predictedPos + dropCompensation

                                if BulletTrackerEnabled then CreateBulletBeam(aimPart.Position, finalPos) end
                                finalArgs[5] = { ["CFrame"] = CFrame.new(aimPart.Position, finalPos) }
                            end
                        end
                        
                        if RapidFireEnabled and RapidFireCount > 1 then
                            for i = 1, RapidFireCount - 1 do task.spawn(function() oldBullet(unpack(finalArgs)) end) end
                        end
                        if BulletTrackerEnabled and not Settings.SilentAimEnabled then CreateBulletBeam(aimPart.Position, aimPart.Position + (aimPart.CFrame.LookVector * 500)) end
                        return oldBullet(unpack(finalArgs))
                    end)
                else Library:Notify("Hookfunction or Bullet Module missing", 5) end

                -- // Scanner Loop (Fixed Crate ESP Scanning)
                local ActiveCrateContents = {}
                task.spawn(function()
                    while true do
                        if CachedCrates and (Settings.AttESP or Settings.AmmoESP or Settings.CrateESP) then
                            local found = {}
                            for _, crate in pairs(CachedCrates) do
                                if crate and crate.Parent then
                                    local inv = crate:FindFirstChild("Inventory")
                                    local gunList, ammoList = {}, {}
                                    if inv then
                                        for _, item in pairs(inv:GetChildren()) do
                                            if Settings.AttESP and item:FindFirstChild("Attachments") and #item.Attachments:GetChildren() > 0 then table.insert(gunList, item.Name .. " [+]") end
                                            if Settings.AmmoESP and (string.find(item.Name, "%d+x%d+") or string.find(item.Name:lower(), "mag")) then table.insert(ammoList, item.Name) end
                                        end
                                    end
                                    if Settings.CrateESP or #gunList > 0 or #ammoList > 0 then table.insert(found, { Crate = crate, Guns = gunList, Ammos = ammoList }) end
                                end
                            end
                            ActiveCrateContents = found
                        else ActiveCrateContents = {} end
                        task.wait(0.5)
                    end
                end)

                -- // =========================================================================
                -- // OPTIMIZED LOOPS
                -- // =========================================================================
                
                local function lerp(a, b, t) return a + (b - a) * t end

                RunService.RenderStepped:Connect(function(dt)
                    CurrentTarget = GetTarget() -- [UPDATES GLOBAL TARGET FOR HOOK]

                    if Settings.AmbientLock then 
                        local finalColor = Color3.new(Settings.BaseAmbientColor.R * Settings.AmbientBrightness, Settings.BaseAmbientColor.G * Settings.AmbientBrightness, Settings.BaseAmbientColor.B * Settings.AmbientBrightness)
                        if Lighting.Ambient ~= finalColor then Lighting.Ambient = finalColor end
                        if Lighting.OutdoorAmbient ~= finalColor then Lighting.OutdoorAmbient = finalColor end
                    end

                    if TriggerbotEnabled and Settings.SilentAimEnabled and not TriggerbotIsShooting then
                        local shouldShoot = false
                        if CurrentTarget and isVisible(Camera.CFrame.Position, CurrentTarget) then shouldShoot = true end
                        if shouldShoot then
                            TriggerbotIsShooting = true
                            task.spawn(function()
                                task.wait(TriggerbotDelay)
                                if VirtualInputManager then VirtualInputManager:SendMouseButtonEvent(0, 0, 0, true, game, 1); task.wait(0.05); VirtualInputManager:SendMouseButtonEvent(0, 0, 0, false, game, 1) else mouse1click() end
                                task.wait(0.1); TriggerbotIsShooting = false
                            end)
                        end
                    end

                    if NoRecoilEnabled or NoSpreadEnabled then
                        for _, ammo in pairs(AmmoFolder:GetChildren()) do
                            local data = OriginalAmmoData[ammo]
                            if data then
                                if NoRecoilEnabled and ammo:GetAttribute("RecoilStrength") ~= 0 then ammo:SetAttribute("RecoilStrength", 0) end
                                if NoSpreadEnabled then if ammo:GetAttribute("Spread") ~= 0 then ammo:SetAttribute("Spread", 0) end; if ammo:GetAttribute("HipSpread") ~= 0 then ammo:SetAttribute("HipSpread", 0) end end
                            end
                        end
                    end

                    if LocalPlayer.Character then
                        if SilentWalkEnabled then local hum = LocalPlayer.Character:FindFirstChild("Humanoid"); local hrp = LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if hum and hrp and hum.MoveDirection.Magnitude > 0 then hrp.CFrame = hrp.CFrame + (hum.MoveDirection * (SilentWalkSpeed * dt)); local oldVel = hrp.Velocity; hrp.Velocity = Vector3.new(oldVel.X, 0, oldVel.Z) end end
                    end

                    if HitboxEnabled then
                        for _, plr in ipairs(Players:GetPlayers()) do 
                            if plr ~= LocalPlayer and plr.Character then 
                                local targetPart = plr.Character:FindFirstChild("FaceHitBox") or plr.Character:FindFirstChild("Head")
                                if targetPart then targetPart.Size = Vector3.new(HitboxSize, HitboxSize, HitboxSize); targetPart.Transparency = HitboxTransparency; targetPart.CanCollide = false; targetPart.Massless = true; targetPart.CanQuery = true; targetPart.CanTouch = true end 
                            end 
                        end
                    end
                end)
                
                local AiNameDrawings = {}
                local function UpdateAiNameESP(model)
                    if not model then return end
                    if not AiNameDrawings[model] then
                        local text = Drawing.new("Text"); text.Center = true; text.Outline = true; text.Font = 2;
                        text.Visible = false
                        AiNameDrawings[model] = text
                        model.AncestryChanged:Connect(function(_, parent) if not parent and AiNameDrawings[model] then AiNameDrawings[model]:Remove(); AiNameDrawings[model] = nil end end)
                    end
                    local textDraw = AiNameDrawings[model]
                    local head = model:FindFirstChild("Head") or model:FindFirstChild("HumanoidRootPart")
                    if not head or not Settings.AiName or not Settings.AiHighlight then textDraw.Visible = false; return end
                    local pos, onScreen = Camera:WorldToViewportPoint(head.Position + Vector3.new(0, 2.5, 0))
                    if onScreen then textDraw.Visible = true; textDraw.Position = Vector2.new(pos.X, pos.Y); textDraw.Text = model.Name or "AI"; textDraw.Size = Settings.AiTextSize; textDraw.Color = Settings.AiNameColor else textDraw.Visible = false end
                end
                
                local function IsAI(name)
                    if AiZones then for _, zone in ipairs(AiZones:GetChildren()) do if zone:FindFirstChild(name) then return true end end end
                    return false
                end

                RunService.RenderStepped:Connect(function()
                    if Camera ~= Workspace.CurrentCamera then Camera = Workspace.CurrentCamera end

                    local myRoot = LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                    local myPos = myRoot and myRoot.Position or Camera.CFrame.Position

                    if Settings.FOVLock then 
                        if Camera.FieldOfView > 55 then
                            Camera.FieldOfView = lerp(Camera.FieldOfView, Settings.CameraFOV, 0.2)
                        end
                    end 

                    pcall(function() 
                        if Settings.FOVPosition == "Mouse" then 
                        FOV.Position = UserInputService:GetMouseLocation() else FOV.Position = GetCenter() end
                        FOV.Visible = Settings.ShowFOV; FOV.Radius = Settings.FOVRadius;
                        FOV.Color = Settings.FOVColor 
                    end)

                    if CurrentTarget then
                        local pos, onScreen = Camera:WorldToViewportPoint(CurrentTarget.Position)
                        
                        if Settings.ShowTargetLine and onScreen then 
                            Snapline.Visible = true; Snapline.From = (Settings.FOVPosition == "Center") and GetCenter() or UserInputService:GetMouseLocation(); Snapline.To = Vector2.new(pos.X, pos.Y); Snapline.Color = Settings.TargetLineColor 
                        else Snapline.Visible = false end

                        if Settings.ShowVisStatus and onScreen then 
                            VisStatusText.Visible = true; VisStatusText.Size = Settings.VisTextSize; VisStatusText.Position = GetCenter() + Vector2.new(0, 40)
                            local isVis = isVisible(Camera.CFrame.Position, CurrentTarget)
                            if isVis then VisStatusText.Text = "VISIBLE"; VisStatusText.Color = Settings.VisColor else VisStatusText.Text = "HIDDEN"; VisStatusText.Color = Color3.fromRGB(255, 0, 0) end 
                        else VisStatusText.Visible = false end

                        if Settings.InventoryViewer and InvGui and CurrentTarget.Parent then UpdateTargetInventory(CurrentTarget.Parent.Name) end
                    else 
                        Snapline.Visible = false; VisStatusText.Visible = false; if InvGui and Settings.InventoryViewer then InvGui.Enabled = false end 
                    end
                    
                    for _, plr in ipairs(Players:GetPlayers()) do 
                        if plr ~= LocalPlayer and plr.Character and not isSameTeam(LocalPlayer, plr) then 
                            UpdateHighlight(plr.Character, Settings.PlayerFillColor, Settings.PlayerOutlineColor, Settings.PlayerChams, Settings.PlayerChamsFill, Settings.PlayerChamsOutline) 
                        end 
                    end
                    
                    if AiZones then 
                        for _, zone in ipairs(AiZones:GetChildren()) do 
                            for _, ai in ipairs(zone:GetChildren()) do 
                                UpdateHighlight(ai, Settings.AiFillColor, Settings.AiOutlineColor, Settings.AiHighlight, Settings.AiChamsFill, Settings.AiChamsOutline)
                                UpdateAiNameESP(ai)
                            end 
                        end 
                    end
                    
                    for player, data in pairs(ESPConnections) do if player and player.Parent then UpdatePlayerESP(player, data) else destroyESP(player) end end

                    if Settings.ItemESP and DroppedItemsFolder then
                        for item, textDraw in pairs(DroppedItemDrawings) do 
                            if item.Parent then 
                                local pos = item:IsA("Model") and item:GetPivot().Position or item.Position
                                local distance = (pos - myPos).Magnitude
                                local screenPos, onScreen = Camera:WorldToViewportPoint(pos)
                                local isPlayerLoot = Players:FindFirstChild(item.Name)
                                local isAILoot = false; if not isPlayerLoot then isAILoot = IsAI(item.Name) end
                                
                                if onScreen and (distance * 0.29) <= Settings.ItemDist and (isPlayerLoot or isAILoot) then 
                                    textDraw.Visible = true; textDraw.Position = Vector2.new(screenPos.X, screenPos.Y); 
                                    textDraw.Text = item.Name .. " Lootbox"; textDraw.Size = Settings.ItemTextSize; textDraw.Color = Settings.ItemColor 
                                else 
                                    textDraw.Visible = false 
                                end 
                            else 
                                textDraw:Remove(); DroppedItemDrawings[item] = nil 
                            end 
                        end
                        for _, item in ipairs(DroppedItemsFolder:GetChildren()) do 
                            if not DroppedItemDrawings[item] and (item:IsA("Model") or item:IsA("BasePart")) then 
                                local isPlayer = Players:FindFirstChild(item.Name); local isAI = false
                                if not isPlayer then isAI = IsAI(item.Name) end
                                if isPlayer or isAI then
                                    local t = Drawing.new("Text"); t.Center = true; t.Outline = true; t.Font = 2
                                    DroppedItemDrawings[item] = t 
                                end
                            end 
                        end
                    else 
                        for i, t in pairs(DroppedItemDrawings) do t:Remove() end; DroppedItemDrawings = {} 
                    end

                    if (Settings.AttESP or Settings.AmmoESP or Settings.CrateESP) then
                        for i = #CrateDrawings, #ActiveCrateContents + 1, -1 do 
                            if CrateDrawings[i] then CrateDrawings[i].NameText:Remove();
                            CrateDrawings[i].GunText:Remove(); CrateDrawings[i].AmmoText:Remove(); table.remove(CrateDrawings, i) end 
                        end
                        
                        for i, data in ipairs(ActiveCrateContents) do
                            if not CrateDrawings[i] then 
                                local nt = Drawing.new("Text"); nt.Center = true; nt.Outline = true; nt.Font = 2; 
                                local gt = Drawing.new("Text"); gt.Center = true; gt.Outline = true; gt.Font = 2; 
                                local at = Drawing.new("Text"); at.Center = true; at.Outline = true; at.Font = 2; CrateDrawings[i] = {NameText = nt, GunText = gt, AmmoText = at} 
                            end
                            
                            local drawings, crate = CrateDrawings[i], data.Crate
                            if crate and crate.Parent then
                                local pos = crate:IsA("Model") and crate:GetPivot().Position or crate.Position; local distance = (pos - myPos).Magnitude
                                local screen, onScreen = Camera:WorldToViewportPoint(pos)
                                
                                UpdateHighlight(crate, Settings.CrateHighlightColor, Color3.new(1,1,1), Settings.CrateESP and Settings.CrateHighlight, true, true)

                                if onScreen and (distance * 0.29) <= Settings.CrateDist and Settings.CrateESP then
                                    local mainOffset = 0
                                    if Settings.CrateName then
                                        drawings.NameText.Visible = true; drawings.NameText.Text = crate.Name; drawings.NameText.Size = Settings.CrateTextSize; drawings.NameText.Color = Settings.CrateTextColor;
                                        drawings.NameText.Position = Vector2.new(screen.X, screen.Y - 30); mainOffset = 15
                                    else drawings.NameText.Visible = false end

                                    if #data.Guns > 0 and Settings.AttESP then 
                                        drawings.GunText.Visible = true; drawings.GunText.Position = Vector2.new(screen.X, screen.Y - 20 + mainOffset); 
                                        drawings.GunText.Text = table.concat(data.Guns, "\n"); drawings.GunText.Size = Settings.AttSize; drawings.GunText.Color = Settings.AttColor 
                                    else drawings.GunText.Visible = false end
                                    
                                    if #data.Ammos > 0 and Settings.AmmoESP then 
                                        drawings.AmmoText.Visible = true; local yOffset = -20 + mainOffset; if drawings.GunText.Visible then yOffset = yOffset + (#data.Guns * Settings.AttSize) + 5 end; drawings.AmmoText.Position = Vector2.new(screen.X, screen.Y + yOffset); 
                                        drawings.AmmoText.Text = table.concat(data.Ammos, "\n"); drawings.AmmoText.Size = Settings.AmmoSize; drawings.AmmoText.Color = Settings.AmmoColor 
                                    else drawings.AmmoText.Visible = false end
                                else 
                                    drawings.NameText.Visible = false; drawings.GunText.Visible = false; drawings.AmmoText.Visible = false 
                                end
                            else 
                                drawings.NameText.Visible = false; drawings.GunText.Visible = false; drawings.AmmoText.Visible = false 
                            end
                        end
                    else 
                        for _, d in pairs(CrateDrawings) do d.NameText.Visible = false;
                        d.GunText.Visible = false; d.AmmoText.Visible = false end 
                    end
                end)

                -- // Loop 3: MISC (0.4s Interval)
                task.spawn(function()
                    while true do
                        if Settings.SilentSteps then 
                            local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart"); if root then for _, sound in pairs(root:GetChildren()) do if sound:IsA("Sound") and (sound.Name == "Running" or sound.Name == "Walking" or sound.Name == "Footstep") then sound.Volume = 0 end end end end
                            if AntiRagdollEnabled and RagdollRemote then pcall(function() RagdollRemote:FireServer(false) end) end
                        task.wait(0.4)
                    end
                end)

                Library:Notify(LPH_ENCSTR("Project Delta | Alcy.z Hub"), 5)
            end)
            if not success then warn("Script Is DOWN!: ", err) end
            
            -- ====================================================
        end

        -- // [HANDLERS]
        GetKeyBtn.MouseButton1Click:Connect(function()
            StatusText.Text = "Status: Generating Link..."
            StatusText.TextColor3 = Color3.fromRGB(255, 200, 0)
            local ok, link = cacheLinkFunc()
            if ok then
                fSetClipboard(link)
                StatusText.Text = "Status: Link Copied!"
                StatusText.TextColor3 = Color3.fromRGB(0, 255, 100)
            else
                StatusText.Text = "Error: " .. tostring(link)
                StatusText.TextColor3 = Color3.fromRGB(255, 50, 50)
            end
            task.wait(2); StatusText.Text = "Status: Waiting..."; StatusText.TextColor3 = Color3.fromRGB(150, 150, 150)
        end)

        DiscordBtn.MouseButton1Click:Connect(function()
            fSetClipboard(DiscordLink)
            StatusText.Text = "Status: Discord Copied!"
            StatusText.TextColor3 = Color3.fromRGB(88, 101, 242)
            task.wait(2); StatusText.Text = "Status: Waiting..."; StatusText.TextColor3 = Color3.fromRGB(150, 150, 150)
        end)

        VerifyBtn.MouseButton1Click:Connect(function()
            local key = KeyInput.Text:gsub("%s+", "")
            if key == "" then StatusText.Text = "Status: Input Empty!"; StatusText.TextColor3 = Color3.fromRGB(255, 50, 50); return end
            StatusText.Text = "Status: Verifying..."; StatusText.TextColor3 = Color3.fromRGB(0, 200, 255)
            task.spawn(function()
                if verifyKeyFunc(key) then LoadMainScript() else StatusText.Text = "Status: Invalid Key!"; StatusText.TextColor3 = Color3.fromRGB(255, 50, 50) end
            end)
        end)
    end)
end)
if not script_success then warn("Key System Error: " .. tostring(script_error)) end
